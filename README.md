Tclssg
=======

A static site generator with template support written in Tcl for danyilbohdan.com. Intended to make it easy to manage a small personal website with an optional blog.

Features
--------

* Mark up content with Markdown.
* Produce plain old pages or blogs post. [1]
* Tag blog posts. Put a tag cloud on your blog index.
* Upload the resulting website over FTP with a single command.
* Embed Tcl code in HTML for templating. [2]
* Generated links are all relative.
* Output is valid HTML5 and CSS level 3.

1\. Blog posts differ from plain old pages in that they have a sidebar of links to other blog posts sorted by recency and tags.

2\. Templating example:

        <article>
        <% textutil::indent $content {        } %>
        </article>

Page screenshot
---------------
![Test page generated by Tclssg](screenshot.png)

Getting started
---------------

To use Tclssg you will need Tcl 8.5 or newer and Tcllib installed. You will also need a Markdown processor to turn Markdown into HTML. The default processor Markdown shipped with Tclssg is [Markdown 1.0.1](http://daringfireball.net/projects/markdown/), which requires Perl 5.

Installing Tcl + Tcllib on Debian/Ubuntu:

    sudo apt-get install tcl tcllib

On Fedora/RHEL/CentOS:

    su -
    yum install tcl tcllib

Once you have the requirements installed clone this repository, `cd` into it then run

    ./ssg.tcl init
    ./ssg.tcl build
    ./ssg.tcl open

This will create a new website project in the directory `website/input`, build it in `website/output` and open the result in the browser. If you're not on Linux instead of running `./ssg.tcl open` open `website/output/index.html` manually.

Usage
-----

    usage: ./ssg.tcl <command> [sourceDir destDir]

`sourceDir` specifies the directory where the input for Tclssg is located. It defaults to `website/input` in the current directory.
`destDir` is where the HTML is put. It defaults to `website/output`.

Possible commands are

* `init` — сreate new project from the default project skeleton (a starting point for Tclssg websites contained in the `skeleton` directory)
* `build` — build a static website in `destDir` based on the data in `sourceDir`
* `clean` — delete all files in `destDir`
* `update` — replace static files and templates in `sourceDir` that have matching ones in the project skeleton with those in the project skeleton. This is used to update your website project when Tclssg itself is updated. Tclssg will prompt you whether to replace each file.
* `upload-copy` — copy files to the destination set in the configuration file (`website.conf`)
* `upload-ftp` — upload files to FTP server set in in the configuration file
* `open` — open index page in the default browser

The default layout of the source directory is

    .
    ├── pages <-- Markdown files from which HTML is generated
    │   ├── blog <-- Blog posts
    │   │   └── index.md <-- Blog index page with tag list
    │   │                    and links to blog posts
    │   ├── index.md <-- Website index page
    ├── static
    │   └── main.css
    ├── templates
    │   └── default.thtml <-- The website's layout
    │                         template (HTML + Tcl)
    └── website.conf <-- Configurating file

To customize your website you can edit its general settings in `website.conf` and the per-page settings in individual page files.

Website settings
----------------

The following settings are specified in the file `website.conf` in `sourceDir` and affect all pages. The format of `website.conf` is as follows:

    variableNameOne short_value
    variableNameTwo {A variable value with spaces.}

| Variable name | Example value(s) | Description |
|---------------|------------------|-------------|
| websiteTitle | `{My Awesome Website}` | Appened to the `<title>` of every page. |
| url | `{http://example.com/}` | Currently not used. |
| uploadCopyPath | `{/var/www/}` | The location to copy the built static website to on command `upload-copy`.|
| uploadFtpServer | `{ftp.hosting.example.net}` | The server to upload the built static website to on command `upload-ftp`. |
| uploadFtpPort | `21` | |
| uploadFtpPath | `{htdocs}` | |
| uploadFtpUser | `{user}` | |
| uploadFtpPassword | `{password}` | |
| expandMacrosInPages | 0/1 | Whether template macros in the format of `<% tclcommand args %>` are allowed in pages. |
| charset | `utf-8` | Page character set. |
| indexPage | `{index.md}` | The page all other pages link back to. |
| tagsPage | `{blog/index.md}` | The page that tags link to. Enable `showTagCloud` on it. |
| copyright | `{Copyright (C) 2014 You}` | A copyright line to display in the footer. |

All 0/1 settings default to `0`.

Per-page variables
------------------
Single lines. Format: a separate lines per variable that say

    ! variableNameOne short_value
    ! variableNameTwo {A variable value with spaces.}

| Variable name | Example value(s) | Description |
|---------------|------------------|-------------|
| pageTitle | `{Some title}` | |
| hideTitle | 0/1 | Do not put `pageTitle` in the `<title>` tag and do not display it at the top of the page. The page title will then only be used for sidebar/tag cloud links to the page. |
| blogEntry | 0/1 | If this is set to 1 the page will show in the blog post list. |
| hideFromSidebar | 0/1 | Unlists the page the sidebar. |
| hideSidebar | 0/1 | Hide the sidebar *on the page.* |
| hidePostTags | 0/1 | Hide whatever tags a blog has. |
| hideFooter | 0/1 | Disable the "Powered by" footer. |
| showTagCloud | 0/1 | Show the list of all tags and links to those blog posts that have each. Presently does not actually look like a cloud. |
| date | `2014`, `20140623`, `2014-06-23`, `2014-06-23 14:35` | . Blog posts are sorted on the `date` field. The date must be in a [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601)-like format of year-month-day-hour-minute. Dashes, spaces, colons, dots and `T` are ignored except between, so ``2014-06-23T14:35:01` is the same as `20140623143501`. |
| tags | `{tag1 tag2 {tag three with multiple words} {tag four} tag-five}` | |
| headExtra | `{<link rel="stylesheet" href="./page-specific.css">}` | |

Like with website settings all 0/1 settings default to `0`.

For multiline page variable values and manipulating website variables just for the current page set `expandMacrosInPages` to `1` and use a macro in the page like

    <%
    dict set pages $currentPageId variables headExtra {
        <link rel="stylesheet"
        href="./contact.css">
    }
    set websiteTitle blah
    lindex ""
    %>

Sample session
--------------

    $ ./ssg.tcl build
    Loaded config file:
        websiteTitle Danyil Bohdan
        url http://danyilbohdan.com/
        uploadCopyPath /tmp/dest
        uploadFtpServer ftp.<webhost>.com
        uploadFtpPath danyilbohdan.com
        uploadFtpUser dbohdan
        uploadFtpPassword ***
        expandMacrosInPages 0
        indexPage index.md
        tagPage blog/index.md
    processing page file data/input/pages/contact.md into data/output/contact.html
    processing page file data/input/pages/index.md into data/output/index.html
    processing page file data/input/pages/total.md into data/output/total.html
    processing page file data/input/pages/blog/index.md into data/output/blog/index.html
    copying file data/input/static/main.css to data/output/main.css
    copying file data/input/static/contact.css to data/output/contact.css
    $ ./ssg.tcl upload-ftp
    Loaded config file:
        websiteTitle Danyil Bohdan
        url http://danyilbohdan.com/
        uploadCopyPath /tmp/dest
        uploadFtpServer ftp.<webhost>.com
        uploadFtpPath danyilbohdan.com
        uploadFtpUser dbohdan
        uploadFtpPassword ***
        expandMacrosInPages 0
        indexPage index.md
        tagPage blog/index.md
    uploading data/output/index.html as danyilbohdan.com/index.html
    uploading data/output/total.html as danyilbohdan.com/total.html
    uploading data/output/contact.html as danyilbohdan.com/contact.html
    uploading data/output/main.css as danyilbohdan.com/main.css
    uploading data/output/contact.css as danyilbohdan.com/contact.css
    uploading data/output/blog/index.html as danyilbohdan.com/blog/index.html

The password value is automatically replaced with "***" in Tclssg log output.

License
-------

MIT. See the file `LICENSE` for details.

Tclssg includes a copy of Markdown 1.0.1, which is copyright (c) 2004, John Gruber, and is distributed under a three-clause BSD license. See `scripts/Markdown_1.0.1/License.text`.
