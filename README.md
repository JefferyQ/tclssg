Tclssg
=======

A static site generator with template support written in Tcl for danyilbohdan.com. Intended to make it easy to manage a small personal website with an optional blog.

Features
--------

* Mark up content with Markdown.
* Produce plain old pages or blogs post. [1]
* Tag blog posts. Put a tag cloud on your blog index.
* Deploy the resulting website over FTP with a single command.
* Embed Tcl code in HTML for templating. [2]
* Generated links are all relative.
* Output is valid HTML5 and CSS level 3.

1\. Blog posts differ from plain old pages in that they have a sidebar of links to other blog posts sorted by recency and tags.

2\. Templating example:

        <article>
        <% textutil::indent $content {        } %>
        </article>

Page screenshot
---------------
![Test page generated by Tclssg](screenshot.png)

Getting started
---------------

To use Tclssg you will need Tcl 8.5 or newer and Tcllib installed. You will also need a Markdown processor to turn Markdown into HTML. The default processor Markdown shipped with Tclssg is [Markdown 1.0.1](http://daringfireball.net/projects/markdown/), which requires Perl 5.

Installing Tcl + Tcllib on Debian/Ubuntu:

    sudo apt-get install tcl tcllib

On Fedora/RHEL/CentOS:

    su -
    yum install tcl tcllib

Once you have the requirements installed clone this repository, `cd` into it then run

    ./ssg.tcl init
    ./ssg.tcl build
    ./ssg.tcl open

This will create a new website project in the directory `website/input`, build it in `website/output` and open the result in the browser. If you're not on Linux instead of running `./ssg.tcl open` open `website/output/index.html` manually.

Concepts
--------

| Concept | Explanation |
|---------|-------------|
| Page | The main building block of your static website. A page is a file with Markdown content based on which a single page of HTML output can be produced. When processed the HTML page is placed under the same relative path with the same file name. The page `test/page1.md` will generate the HTML file `test/page1.html` in output directory. A page can be a blog post (see below) or not. |
| Blog post | Blog posts are like normal pages but they can have tags and a blog sidebar with links to other blog posts.
| Index | A page all normal pages have a link back to at the top (by default). |
| Blog index | A page all blog pages have a link back to at the top (by default). | |
| Template | A file with Tcl code embedded in HTML markup. When pages are converted from Markdown to HTML their content is inserted into a template and rendered according to that templates logic (code). |
| Config file | The file `website.conf` in the input directory that specifies the options that apply to a static website as a whole like the website title. |
| Variable | When set in a page file a variable specifies a setting for that individual page. When set in the config file a variable specifies a setting for the website as a whole. |
| Static file | The files that should be copied verbatim from a subdirectory in the input directory (`inputDir/static`) to the output directory. |
| Output | The HTML files created by Tclssg based on the content in the input directory plus the static files. It is placed in the output directory `outputDir`. |

Usage
-----

    usage: ./ssg.tcl <command> [options] [inputDir [outputDir]]

`inputDir` specifies the directory where the input for Tclssg is located. It defaults to `website/input` in the current directory.
`outputDir` is where the HTML is put. It defaults to `website/output` and can also be set in the configuration file in `inputDir`.

Possible commands are

* `init [--templates]` — сreate new project from the default project skeleton (a starting point for Tclssg websites contained in the `skeleton` directory).

> **NOTE:** The option `--templates` will make `init` copy the template files from the project skeleton into a subdirectory named `templates` in `inputDir`. You should only use it if you intend to customize your page's layout (HTML code); it is not necessary if you only intend to customize the pages' look using CSS.

>By default your project will use the page template from the project skeleton. Not keeping a separate copy of the template is a good idea because it means you won't have to update it manually when a new version of Tclssg introduces changes to templating (which at this point in development it may).

* `build` — build a static website in `outputDir` based on the data in `inputDir`.
* `clean` — delete all files in `outputDir`.
* `update [--templates]` — replace static files in `inputDir` that have matching ones in the project skeleton with those in the project skeleton. Do the same with templates if the option `--templates` is given. This is used to update your website project when Tclssg itself is updated. Tclssg will prompt you whether to replace each file.
* `deploy-copy` — copy files to the destination set in the configuration file (`website.conf`).

> **NOTE:** This can be used, e.g., if your build machine is your web server or if you have the server's documents directory mounted as a local path.

* `deploy-ftp` — deploy files to FTP server set in the configuration file.
* `open` — open index page in the default browser.

The default layout of the input directory is

    .
    ├── pages <-- Markdown files from which HTML is generated.
    │   ├── blog <-- Blog posts.
    │   │   └── index.md <-- Blog index page with tag list
    │   │                    and links to blog posts.
    │   ├── index.md <-- Website index page.
    ├── static <-- Files copied verbatim to the output
    │   │          directory.
    │   └── main.css
    ├── templates
    │   └── default.thtml <-- The website's layout
    │                         template (HTML + Tcl).
    └── website.conf <-- Configurating file.

Once you've initialized your website with `init` you customize it with general and per-page setting. Edit its general settings in `website.conf` and the per-page settings in the individual page files.

Website settings
----------------

The following settings are specified in the file `website.conf` in `inputDir` and affect all pages. The format of `website.conf` is as follows:

    variableNameOne short_value
    variableNameTwo {A variable value with spaces.}

| Variable name | Example value(s) | Description |
|---------------|------------------|-------------|
| websiteTitle | `{My Awesome Website}` | Appened to the `<title>` of every page. E.g., in this example if `pageTitle` of a page is `{Hello!}` the `<title>` tag will say "Hello! &#124; My Awesome Website".  |
| url | `{http://example.com/}` | Currently not used. |
| outputDir | `../output`, `/var/www/` | The default destination directory under which HTML output is produced. Relative paths are taken as relative to `inputDir` (as given on the command line). |
| templateFileName | `x.thtml` | If none is specified then `default.thtml` is used. |
| deployCopyPath | `{/var/www/}` | The location to copy the built static website to on command `deploy-copy`. |
| deployFtpServer | `{ftp.hosting.example.net}` | The server to deploy the built static website to on command `deploy-ftp`. |
| deployFtpPort | `21` | FTP port. |
| deployFtpPath | `{htdocs}` | The directory on the FTP server where to deploy the static website. |
| deployFtpUser | `{user}` | FTP user name. |
| deployFtpPassword | `{password}` | FTP password. |
| expandMacrosInPages | 0/1 | Whether template macros in the format of `<% tclcommand args %>` are allowed in pages. |
| charset | `utf-8` | Page character set. |
| indexPage | `{index.md}` | The page normal pages will have a link back to. |
| blogIndexPage | `{blog/index.md}` | The page blog post pages will have a link back to. |
| tagsPage | `{blog/index.md}` | The page that tags link to. Enable `showTagCloud` on it. |
| copyright | `{Copyright (C) 2014 You}` | A copyright line to display in the footer. |

All 0/1 settings default to `0`.

Per-page variables
------------------
Per-page variables alter setting for just the page they are set on. They are set in the page source file (e.g., `{index.md}`), each one on a separate line that start with `!` (exclamation mark) and has the form of `! variableName {Value}`. Those lines are normally placed at the top of the page source file. Example usage:

    ! variableNameOne short_value
    ! variableNameTwo {A variable value with spaces.}
    Lorem ipsum... (The rest of the page content follows.)

Variable that can be set on any page:

| Variable name | Example value(s) | Description |
|---------------|------------------|-------------|
| pageTitle | `{Some title}` | Title of the individual page. By default it goes in the `<title>` tag and the article header at the top of the page. It is also used as the text for sidebar/tag cloud links to the page. |
| hideTitle | 0/1 | Do not put `pageTitle` in the `<title>` tag and do not display it at the top of the page. The page title will then only be used for sidebar/tag cloud links to the page. |
| blogEntry | 0/1 | If this is set to 1 the page will be a blog post. It will show in the blog post list. |
| date | `2014`, `2014/06/23`, `2014-06-23`, `2014-06-23 14:35`, `2014-06-23 14:35:01` | . Blog posts are sorted on the `date` field. The date must be in a [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601)-like format of year-month-day-hour-minute. Dashes, spaces, colons, slashes, dots and `T` are all treated the same for sorting, so `2014-06-23T14:35:01` is equivalent to `2014 06 23 14 35 01`. |
| headExtra | `{<link rel="stylesheet" href="./page-specific.css">}` | Line to append to `<head>`. |

Variables that have meaning only for blog posts:

| Variable name | Example value(s) | Description |
|---------------|------------------|-------------|
| hideFromSidebar | 0/1 | Unlists the post from other posts' sidebar. |
| hideSidebar | 0/1 | Don't show the sidebar *on the present page.* |
| hidePostTags | 0/1 | Don't show whatever tags a blog post has. |
| showTagCloud | 0/1 | Show the list of all tags and links to those blog posts that have each. Presently does not actually look like a cloud. |
| hidePrevNextLinks | 0/1 | Hide previous and next blog post links. |
| hideFooter | 0/1 | Disable the "Powered by" footer. |
| tags | `{tag1 tag2 {tag three with multiple words} {tag four} tag-five}` | Blog post tags for categorization. Each tag will link to the page `tagPage`. |

Like with website settings all 0/1 settings default to `0`.

For multiline page variable values and manipulating website variables just for the current page set `expandMacrosInPages` to `1` and use a macro in the page like

    <%
    dict set pages $currentPageId variables headExtra {
        <link rel="stylesheet"
        href="./contact.css">
    }
    set websiteTitle blah
    lindex ""
    %>

Sample session
--------------

    $ ./ssg.tcl build
    Loaded config file:
        websiteTitle Danyil Bohdan
        url http://danyilbohdan.com/
        deployCopyPath /tmp/dest
        deployFtpServer ftp.<webhost>.com
        deployFtpPath danyilbohdan.com
        deployFtpUser dbohdan
        deployFtpPassword ***
        expandMacrosInPages 0
        indexPage index.md
        tagPage blog/index.md
    processing page file website/input/pages/contact.md into website/output/contact.html
    processing page file website/input/pages/index.md into website/output/index.html
    processing page file website/input/pages/total.md into website/output/total.html
    processing page file website/input/pages/blog/index.md into website/output/blog/index.html
    copying file website/input/static/main.css to website/output/main.css
    copying file website/input/static/contact.css to website/output/contact.css
    $ ./ssg.tcl deploy-ftp
    Loaded config file:
        websiteTitle Danyil Bohdan
        url http://danyilbohdan.com/
        deployCopyPath /tmp/dest
        deployFtpServer ftp.<webhost>.com
        deployFtpPath danyilbohdan.com
        deployFtpUser dbohdan
        deployFtpPassword ***
        expandMacrosInPages 0
        indexPage index.md
        tagPage blog/index.md
    uploading website/output/index.html as danyilbohdan.com/index.html
    uploading website/output/total.html as danyilbohdan.com/total.html
    uploading website/output/contact.html as danyilbohdan.com/contact.html
    uploading website/output/main.css as danyilbohdan.com/main.css
    uploading website/output/contact.css as danyilbohdan.com/contact.css
    uploading website/output/blog/index.html as danyilbohdan.com/blog/index.html

The password value is automatically replaced with "***" in Tclssg log output.

License
-------

MIT. See the file `LICENSE` for details.

Tclssg includes a copy of Markdown 1.0.1, which is copyright (c) 2004, John Gruber, and is distributed under a three-clause BSD license. See `external/Markdown_1.0.1/License.text`.
